# DLLStuff

This is the result of investigation that one of my colleagues asked me to look into.  

In essence can I create a utility that
* can accept an command message
* dynamically load a function from a DLL (both specified in the message)
* execute the function with parameters passed in the message.  
* can be containerised
* can be hosted on a number of container related platforms?

The answer to all the questions above is a resounding **YES**, but unfortunately the preferred container hosting platfrom is Azure Container Instances, and there is a little glitch there at the moment (that should be resolved very soon). 

This repo contains everything you need to get you own example up and running...

## Introduction

I haven't fully autmoated the deployment of this (I dont think enough people will want o try it to warrant that).  The remainder of this page should give you enough pointers to deploy it if you want to.

## Building the application

Clone/fork this repo and open the solution in Visual Studio (2019).  Ensure that the solution builds.

## Preparing to run locally

In your azure subscription:
* create a storage account with a container to hold inputs and results.  Note the connection string and container name
* create a service bus namespace and a queue within the namespace. Note the connection string and the queue name
* Add a file called local.settings.json in DLLStuff and ReqestCreator projects

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{
  "Logging": {
    "LogLevel": {
      "Default": "Warning"
    }
  },
  "StorageConnectionString": "",
  "ServiceBusConnectionString": "",
  "ServiceBusQueueName": "calculation-queue"`
  
*ensure this file is excluded from source control and copied to the output directory on build*

* In settings.json in the RequestCreator project configure the container name you created above
`{
  "ContainerName": "dllstuff"
}`

Upload the two native 32-bit DLLs (DLLStuff\dll?) that I developed for this exercise from your local drive to the container you created above.

* TurgidEagle.dll
* WiltedBeetroot.dll

These are analagous to the model DLLs generated by modelling tools.  Note that the dependencies for the DLLs (ucrtbased.dll and vcruntime140d.dll) are stored in the root of the DLLStuff application and will be deployed along with it.

## Running locally

Change to the directory where the built RequestCreator.exe file is stored (DLLStuff\RequestCreator\bin\debug?) and run RequestCreator -h.  This will give you a description of the command:

![screenshot of the RequestCreator -h command output](docs/requestcreator-help.jpg)


## Creating the Azure Infrastructure
## Creating a container
## Deploy to ACI
## Deploy to AKS
## Summary
